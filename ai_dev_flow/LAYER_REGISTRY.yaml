# SDD Framework Layer Registry
# Single source of truth for all layer definitions
# Version: 1.4
# Last Updated: 2026-01-15

version: "1.4"
metadata:
  framework: "Specification-Driven Development (SDD)"
  total_layers: 15  # Changed from 16: IPLAN (Layer 12) deprecated and merged into TASKS
  additional_artifacts: ["ICON"]
  maintainer: "SDD Framework Team"
  template_policy: mvp_only  # Framework uses MVP templates exclusively
  deprecated_templates: archived/  # Full/section templates moved to archived/ subdirectories
  deprecated_artifacts: ["IPLAN"]  # IPLAN merged into TASKS as of 2026-01-15

# Optional pre-artifact layer (not part of core 15 artifact layers)
conceptual_layers:
  - number: 0
    artifact: STRAT
    name: "Strategy"
    description: "External business strategy documents (market analysis, vision)"
    documented: false
    optional: true

layers:
  - number: 1
    artifact: BRD
    name: "Business Requirements Document"
    folder: 01_BRD/
    extensions: [.md]
    required_tags: []
    can_reference: []
    error_prefix: BRD
    optional: false
    description: "Layer 1 - Business-level functional requirements and objectives"
    template: "BRD-MVP-TEMPLATE.md"

  - number: 2
    artifact: PRD
    name: "Product Requirements Document"
    folder: 02_PRD/
    extensions: [.md]
    required_tags: [brd]
    can_reference: [BRD]
    error_prefix: PRD
    optional: false
    description: "Layer 2 - Product features and user stories derived from BRD"
    template: "PRD-MVP-TEMPLATE.md"

  - number: 3
    artifact: EARS
    name: "Easy Approach to Requirements Syntax"
    folder: 03_EARS/
    extensions: [.md]
    required_tags: [brd, prd]
    can_reference: [BRD, PRD]
    error_prefix: EARS
    optional: false
    description: "Layer 3 - Formal requirements using WHEN-THE-SHALL-WITHIN syntax"
    template: "EARS-MVP-TEMPLATE.md"

  - number: 4
    artifact: BDD
    name: "Behavior-Driven Development"
    folder: 04_BDD/
    extensions: [.feature, .md]
    required_tags: [brd, prd, ears]
    can_reference: [BRD, PRD, EARS]
    error_prefix: BDD
    optional: false
    description: "Layer 4 - Test scenarios using Given-When-Then format"
    template: "BDD-MVP-TEMPLATE.feature"

  - number: 5
    artifact: ADR
    name: "Architecture Decision Record"
    folder: 05_ADR/
    extensions: [.md]
    required_tags: [brd, prd, ears, bdd]
    can_reference: [BRD, PRD, EARS, BDD]
    error_prefix: ADR
    optional: false
    description: "Layer 5 - Architectural decisions with Context-Decision-Consequences"
    template: "ADR-MVP-TEMPLATE.md"

  - number: 6
    artifact: SYS
    name: "System Requirements"
    folder: 06_SYS/
    extensions: [.md]
    required_tags: [brd, prd, ears, bdd, adr]
    can_reference: [BRD, PRD, EARS, BDD, ADR]
    error_prefix: SYS
    optional: false
    description: "Layer 6 - Functional requirements and quality attributes"
    template: "SYS-MVP-TEMPLATE.md"

  - number: 7
    artifact: REQ
    name: "Atomic Requirements"
    folder: 07_REQ/
    extensions: [.md]
    required_tags: [brd, prd, ears, bdd, adr, sys]
    can_reference: [BRD, PRD, EARS, BDD, ADR, SYS]
    error_prefix: REQ
    optional: false
    description: "Layer 7 - Single, granular, testable requirements"
    template: "REQ-MVP-TEMPLATE.md"

  - number: 8
    artifact: IMPL
    name: "Implementation Approach"
    folder: 08_IMPL/
    extensions: [.md]
    required_tags: [brd, prd, ears, bdd, adr, sys, req]
    can_reference: [BRD, PRD, EARS, BDD, ADR, SYS, REQ]
    error_prefix: IMPL
    optional: true
    description: "Layer 8 - WHO-WHEN-WHAT implementation strategy"
    template: "IMPL-TEMPLATE.md"

  - number: 9
    artifact: CTR
    name: "Data Contracts"
    folder: 09_CTR/
    extensions: [.md, .yaml]
    required_tags: [brd, prd, ears, bdd, adr, sys, req]
    can_reference: [BRD, PRD, EARS, BDD, ADR, SYS, REQ, IMPL]
    error_prefix: CTR
    optional: true
    description: "Layer 9 - API/data contracts using dual-file format"
    template: "CTR-TEMPLATE.md"

  - number: 10
    artifact: SPEC
    name: "Technical Specifications"
    folder: 10_SPEC/
    extensions: [.yaml, .md]
    required_tags: [brd, prd, ears, bdd, adr, sys, req]
    can_reference: [BRD, PRD, EARS, BDD, ADR, SYS, REQ, IMPL, CTR]
    error_prefix: SPEC
    optional: false
    description: "Layer 10 - Implementation-ready YAML specifications"
    template: "SPEC-TEMPLATE.yaml"

  - number: 11
    artifact: TASKS
    name: "Task Breakdown"
    folder: 11_TASKS/
    extensions: [.md]
    required_tags: [brd, prd, ears, bdd, adr, sys, req, spec]
    can_reference: [BRD, PRD, EARS, BDD, ADR, SYS, REQ, IMPL, CTR, SPEC]
    error_prefix: TASKS
    optional: false
    description: "Layer 11 - AI-structured TODO tasks from SPEC"
    template: "TASKS-TEMPLATE.md"

  # DEPRECATED: Layer 12 IPLAN has been merged into TASKS (Layer 11)
  # Execution commands are now in TASKS Section 4
  # See 12_IPLAN/DEPRECATED.md for migration guide
  # Keeping this entry commented for historical reference:
  # - number: 12
  #   artifact: IPLAN
  #   name: "Implementation Plan"
  #   folder: 12_IPLAN/
  #   status: DEPRECATED (merged into TASKS as of 2026-01-15)

  - number: 12
    artifact: CODE
    name: "Source Code"
    folder: src/
    extensions: [.py, .js, .ts, .java, .go, .rb, .php, .cpp, .c, .h]
    required_tags: [brd, prd, ears, bdd, adr, sys, req, spec, tasks]
    can_reference: [BRD, PRD, EARS, BDD, ADR, SYS, REQ, IMPL, CTR, SPEC, TASKS]
    error_prefix: CODE
    optional: false
    description: "Layer 12 - Source code implementation generated from TASKS"
    template: null  # Code layer - no documentation template

  - number: 13
    artifact: TESTS
    name: "Test Suite"
    folder: tests/
    extensions: [.py, .js, .ts, .java, .go, .rb, .php, .cpp]
    required_tags: [brd, prd, ears, bdd, adr, sys, req, spec, tasks, code]
    can_reference: [BRD, PRD, EARS, BDD, ADR, SYS, REQ, IMPL, CTR, SPEC, TASKS, CODE]
    error_prefix: TEST
    optional: false
    description: "Layer 13 - Unit, integration, and end-to-end test implementations"
    template: null  # Test layer - no documentation template

  - number: 14
    artifact: VALIDATION
    name: "Validation Results"
    folder: validation/
    extensions: [.md, .json, .yaml, .xml]
    required_tags: []  # Consumes all upstream tags, count not strictly enforced
    can_reference: [BRD, PRD, EARS, BDD, ADR, SYS, REQ, IMPL, CTR, SPEC, TASKS, CODE, TESTS]
    error_prefix: VAL
    optional: false
    description: "Layer 14 - Production readiness validation and quality gate results"
    template: null  # Validation layer - no documentation template

# Change Management Utilities (NOT layers)
change_management:
  artifact: CHG
  name: "Change Management"
  folder: CHG/
  purpose: "Document archival and immutability enforcement"
  not_a_layer: true
  description: "Archival mechanism for superseded documents. When requirements change, old documents are archived in CHG/ and NEW documents are created from scratch to prevent LLM probabilistic errors. After archival, entire layer chain must be regenerated."

additional_artifacts:
  - artifact: ICON
    name: "Implementation Contracts"
    folder: ICON/
    extensions: [.md]
    required_tags: [tasks]
    can_reference: [TASKS]
    error_prefix: ICON
    optional: true
    description: "Non-layer artifact - Type contracts for parallel development"
    template: "ICON-TEMPLATE.md"

layer_groups:
  core_requirements:
    layers: [1, 2, 3, 4]
    description: "Business and product requirements"

  architecture:
    layers: [5, 6, 7]
    description: "Architecture and detailed requirements"

  implementation_design:
    layers: [8, 9, 10, 11]
    description: "Implementation design artifacts"
  
  execution:
    layers: [12, 13, 14]
    description: "Code execution and validation layers"

id_patterns:
  standard: "^[A-Z]+-\\d{2,}$"
  sectioned: "^[A-Z]+-\\d{2,}\\.\\d+$"
  hierarchical: "^[A-Z]+\\.\\d{2}\\.\\d{2}\\.\\d{2}$"
