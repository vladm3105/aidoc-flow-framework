# FTEST_MVP_SCHEMA.yaml
# JSON Schema for Functional Test Specification validation
# Version: 1.0

$schema: "http://json-schema.org/draft-07/schema#"
$id: "https://ai-dev-flow/schemas/ftest-mvp-v1.0.json"
title: "FTEST MVP Schema"
description: "Validation schema for Functional Test Specification documents"
type: object

required:
  - metadata
  - document_control
  - test_scope
  - test_case_index
  - test_case_details
  - sys_coverage_matrix
  - traceability

properties:
  metadata:
    type: object
    required:
      - document_id
      - title
      - artifact_type
      - layer
      - test_type_code
    properties:
      document_id:
        type: string
        pattern: "^FTEST-\\d{2,}$"
      artifact_type:
        type: string
        const: "FTEST"
      layer:
        type: integer
        const: 10
      test_type_code:
        type: integer
        const: 43

  document_control:
    type: object
    required:
      - status
      - system_scope
      - sys_reference
      - quality_attributes
      - coverage_target
    properties:
      status:
        type: string
        enum: ["Draft", "Review", "Approved", "Implemented"]
      system_scope:
        type: string
        minLength: 1
      sys_reference:
        type: string
        pattern: "^SYS\\.\\d{2,}\\.\\d{2}\\.\\d{2,}$"
      quality_attributes:
        type: array
        minItems: 1
        items:
          type: string
          enum: ["Performance", "Reliability", "Security", "Scalability"]
      coverage_target:
        type: integer
        minimum: 75
        maximum: 100

  test_scope:
    type: object
    required:
      - system_under_test
      - quality_attributes
      - threshold_definitions
    properties:
      system_under_test:
        type: object
        required:
          - system
          - sys_reference
      quality_attributes:
        type: array
        minItems: 1
        items:
          type: object
          required:
            - attribute
            - sys_reference
            - threshold_reference
      threshold_definitions:
        type: array
        minItems: 1
        items:
          type: object
          required:
            - id
            - attribute
            - metric
            - target
            - source

  test_case_index:
    type: array
    minItems: 1
    items:
      type: object
      required:
        - id
        - name
        - quality_attribute
        - sys_coverage
        - priority
      properties:
        id:
          type: string
          pattern: "^TSPEC\\.\\d{2,}\\.43\\.\\d{2,}$"
        quality_attribute:
          type: string
          enum: ["Performance", "Reliability", "Security", "Scalability"]
        sys_coverage:
          type: string
          pattern: "^SYS\\.\\d{2,}\\.\\d{2}\\.\\d{2,}$"
        priority:
          type: string
          enum: ["P1", "P2", "P3"]

  test_case_details:
    type: array
    minItems: 1
    items:
      type: object
      required:
        - id
        - name
        - quality_attribute
        - traceability
        - threshold_validation
        - workflow_steps
        - measurement_methodology
      properties:
        id:
          type: string
          pattern: "^TSPEC\\.\\d{2,}\\.43\\.\\d{2,}$"
        traceability:
          type: object
          required:
            - sys
            - threshold
        threshold_validation:
          type: array
          minItems: 1
          items:
            type: object
            required:
              - metric
              - threshold
              - measurement
        workflow_steps:
          type: array
          minItems: 3
          items:
            type: object
            required:
              - step
              - action
              - expected_result
        measurement_methodology:
          type: string
          minLength: 20

  sys_coverage_matrix:
    type: array
    minItems: 1
    items:
      type: object
      required:
        - sys_id
        - quality_attribute
        - test_ids
        - covered
      properties:
        sys_id:
          type: string
          pattern: "^SYS\\.\\d{2,}\\.\\d{2}\\.\\d{2,}$"
        quality_attribute:
          type: string
        test_ids:
          type: array
          items:
            type: string
        covered:
          type: boolean

  traceability:
    type: object
    required:
      - upstream
    properties:
      upstream:
        type: array
        minItems: 2
        items:
          type: object
          required:
            - tag
            - reference
          properties:
            tag:
              type: string
              enum: ["@sys", "@threshold", "@spec"]
            reference:
              type: string
