# Deployment Examples for REQ Documents

**Purpose**: Examples demonstrating Section 9.5 deployment requirements for fully automated MVP deployment.

---

## Overview

This directory contains example REQ documents with comprehensive Section 9.5 deployment requirements that enable Autopilot to generate:

- Shell scripts (setup, install, deploy, rollback, health-check, cleanup)
- Ansible playbooks (provisioning, configuration, deployment, monitoring, security, backup)
- IaC templates (Terraform, CloudFormation)
- CI/CD pipeline configurations
- Docker configurations

---

## Example Files

| File | Description |
|-------|-------------|
| [REQ-02_deployment_requirements_example.md](REQ-02_deployment_requirements_example.md) | Complete example REQ demonstrating all 8 subsections of Section 9.5 |

---

## Section 9.5 Deployment Requirements

### 9.5.1 Infrastructure Requirements

Captures cloud infrastructure specifications:

| Resource Type | Provider | Configuration | Requirements |
|---------------|----------|--------------|--------------|
| Compute | [From @adr: ADR-NN] | [Type: EC2/ECS/Cloud Run/GKE] | [CPU, Memory, Scaling: min/max] |
| Database | [From @adr: ADR-NN] | [Type: RDS/Cloud SQL/Postgres] | [Version, Storage: GB, HA: yes/no] |
| Storage | [From @adr: ADR-NN] | [Type: S3/Cloud Storage/EBS] | [Bucket type, Retention: days] |
| Network | [From @adr: ADR-NN] | [VPC, Subnets, Load Balancer] | [CIDR, AZs, Security Groups] |
| Cache | [Optional] | [Type: Redis/Memcached/ElastiCache] | [Memory: GB, TTL: seconds] |
| Message Queue | [Optional] | [Type: SQS/PubSub/Kafka] | [Queue type, Retention: days] |

**Key Point**: Cloud provider decisions are defined in upstream artifacts (BRD, PRD, ADR). Section 9.5.1 references these decisions using `@adr` tags.

### 9.5.2 Environment Configuration

Defines deployment strategy for each environment:

| Environment | Deployment Strategy | Rollback Time | Replicas | Regions |
|-------------|---------------------|---------------|-----------|---------|
| Development | [Manual/CI] | N/A | [1] | [Region] |
| Staging | [Blue-Green/Canary/Rolling] | [X minutes] | [N] | [Region] |
| Production | [Blue-Green/Canary/Rolling] | [X minutes] | [N] | [Regions for HA] |

**Health Endpoints**:
- Liveness: `/health/live` - Container health check
- Readiness: `/health/ready` - Service availability check
- Startup: `/health/startup` - Initialization complete check

### 9.5.3 Deployment Scripts Requirements

Specifies 6 required shell scripts generated by Autopilot:

| Script Name | Purpose | Automation Level | Required for Environments |
|-------------|---------|------------------|-------------------------|
| `setup.sh` | Initial environment setup (dependencies, tools, paths) | Fully automated | All |
| `install.sh` | Application installation/configuration (packages, config files) | Fully automated | All |
| `deploy.sh` | Main deployment orchestration (build, push, deploy) | Fully automated | Staging, Production |
| `rollback.sh` | Rollback to previous version | Fully automated | Staging, Production |
| `health-check.sh` | Health verification post-deployment | Fully automated | All |
| `cleanup.sh` | Cleanup old versions, temporary files | Fully automated | All |

**Script Standards**:
- Shell: Bash 4.0+ compatible
- Logging: All scripts log to `logs/deployment_YYYYMMDD_HHMMSS.log`
- Exit codes: 0 (success), 1 (error), 2 (warning)
- Error handling: `set -euo pipefail` for all scripts
- Idempotency: All scripts safe to run multiple times

### 9.5.4 Ansible Playbook Requirements

Specifies 6 required Ansible playbooks generated by Autopilot:

| Playbook Name | Purpose | Target | Variables | Tags |
|---------------|---------|--------|------------|------|
| `provision_infra.yml` | Provision infrastructure (VPC, EC2, RDS, etc.) | Cloud provider API | Cloud resources config | `infra, provision` |
| `configure_instances.yml` | Configure instances (OS settings, packages, users) | Instance hosts | Instance config, packages | `config, instances` |
| `deploy_app.yml` | Deploy application (copy code, restart service) | Application hosts | App version, config | `deploy, app` |
| `configure_monitoring.yml` | Setup monitoring/alerting (Prometheus, Grafana) | Monitoring hosts | Monitoring config, alerts | `monitoring, observability` |
| `configure_security.yml` | Setup security (firewall, IAM, TLS) | All hosts | Security rules, certificates | `security, hardening` |
| `backup_restore.yml` | Backup/restore procedures (database, config) | Backup hosts | Backup schedule, retention | `backup, recovery` |

**Playbook Standards**:
- Ansible version: 2.9+
- Inventory: Dynamic inventory from cloud provider
- Roles: Modular role-based structure
- Idempotency: All playbooks idempotent
- Handlers: Service restart handlers for configuration changes
- Check mode: Support `--check` for dry-run

### 9.5.5 Observability Requirements

Defines logging, metrics, tracing, and dashboards:

| Type | Tool | Metrics/Logs | Retention | Alerts |
|------|------|--------------|-----------|--------|
| Logging | [Cloud Logging/ELK] | [Format: JSON] | [X days] | [Error threshold, rate thresholds] |
| Metrics | [Prometheus/Datadog] | [p50/p95/p99 latency, throughput, errors] | [X days] | [SLA breaches, degradation] |
| Tracing | [Jaeger/Cloud Trace/OpenTelemetry] | [Sample rate: %] | [X days] | [Slow requests, errors] |
| Dashboards | [Grafana/Datadog] | [Business metrics, health metrics] | N/A | N/A |

### 9.5.6 Security Requirements

Captures security requirements for deployment artifacts:

| Security Aspect | Requirement | Tool/Service | Verification |
|-----------------|-------------|---------------|---------------|
| Secrets Management | [Vault/AWS Secrets Manager/GCP Secret Manager] | [Service name, path] | [Secrets rotated every X days] |
| TLS/SSL | [Certificate manager/Let's Encrypt] | [Domain, certificate type] | [TLS 1.3+, valid certificate] |
| IAM | [Roles/Policies] | [Permissions: read/write/admin] | [Least privilege enforced] |
| Network Security | [VPC, Security Groups, NACLs] | [Allowed IPs, ports] | [Firewall rules audited] |
| Container Security | [Image scanning] | [Vulnerability thresholds] | [No critical vulnerabilities] |

### 9.5.7 Cost Constraints

Defines budget constraints and optimization strategies:

| Resource | Budget | Alerts | Optimization |
|----------|--------|--------|--------------|
| Compute | [Monthly: $X] | [Threshold: 80%] | [Savings plans, spot instances] |
| Storage | [Monthly: $X] | [Threshold: 80%] | [Lifecycle policies, compression] |
| Network | [Monthly: $X] | [Threshold: 80%] | [CDN, compression] |
| Total | [Monthly: $X] | [Threshold: 80%] | [Resource rightsizing] |

### 9.5.8 Deployment Automation Requirements

Defines fully automated deployment workflow:

**Automation Level**: Fully automated (no manual steps)

**Deployment Workflow**:
1. Autopilot generates deployment artifacts (scripts, playbooks)
2. CI/CD pipeline triggers on merge to main
3. Scripts run setup → install → deploy → health-check
4. If health-check fails: auto-rollback
5. Success: update load balancer, monitoring dashboards

**Validation Requirements**:
- Pre-deployment: All tests pass, no security vulnerabilities
- Post-deployment: Health checks pass, performance within SLA
- Monitoring: All metrics collected, dashboards updated
- Rollback: Ready within X minutes

---

## Usage

### Creating Deployment Requirements in Your REQ

1. **Start from REQ-MVP-TEMPLATE.md**: Use the template with Section 9.5 included
2. **Reference Cloud Provider Decisions**: Use `@adr` tags to reference BRD, PRD, and ADR cloud provider selections
3. **Specify Infrastructure**: Complete Section 9.5.1 table with your cloud resources
4. **Define Environments**: Configure deployment strategy (blue-green, canary, rolling) for each environment
5. **List Required Scripts**: Specify all 6 scripts in Section 9.5.3
6. **Define Playbooks**: Specify all 6 playbooks in Section 9.5.4
7. **Add Observability**: Define logging, metrics, tracing, and dashboards
8. **Set Security Requirements**: Specify secrets management, TLS/SSL, IAM, and network security
9. **Define Cost Constraints**: Set budget limits and optimization strategies
10. **Specify Automation Workflow**: Define fully automated deployment steps

### Traceability

Section 9.5 includes traceability to:
- **Upstream**: `@brd`, `@prd`, `@ears`, `@bdd`, `@adr`, `@sys` (all 6 required)
- **Downstream**: `@deployment`, `@ansible`, `@iac` (scripts, playbooks, IaC templates)

### Autopilot Generation

When Autopilot processes REQ documents with Section 9.5, it generates:

**Shell Scripts** (`scripts/` directory):
- `setup.sh` - Environment setup
- `install.sh` - Application installation
- `deploy.sh` - Main deployment orchestration
- `rollback.sh` - Rollback to previous version
- `health-check.sh` - Health verification
- `cleanup.sh` - Cleanup old versions

**Ansible Playbooks** (`ansible/` directory):
- `provision_infra.yml` - Infrastructure provisioning
- `configure_instances.yml` - Instance configuration
- `deploy_app.yml` - Application deployment
- `configure_monitoring.yml` - Monitoring setup
- `configure_security.yml` - Security hardening
- `backup_restore.yml` - Backup/restore procedures

**IaC Templates** (`terraform/` directory):
- VPC configuration
- EC2/ECS resources
- RDS database
- S3 storage
- Security groups
- IAM roles

**CI/CD Pipeline** (`.github/workflows/` directory):
- Automated build and deployment pipeline
- Integration with deployment scripts
- Health check verification
- Automatic rollback on failure

---

## Validation

Use these validation checks to ensure Section 9.5 is complete:

| Check | Description | Pass Criteria |
|-------|-------------|---------------|
| Infrastructure table complete | All required resources specified | Compute, database, storage, network defined |
| Environment configuration complete | All 3 environments defined | Dev, staging, production with strategy |
| Scripts table complete | All 6 scripts specified | Setup, install, deploy, rollback, health-check, cleanup |
| Playbooks table complete | All 6 playbooks specified | Provision, configure, deploy, monitoring, security, backup |
| Observability defined | All 4 types specified | Logging, metrics, tracing, dashboards |
| Security requirements defined | All 5 aspects specified | Secrets, TLS, IAM, network, container |
| Cost constraints defined | Budget and alerts specified | All 4 resources with thresholds |
| Automation workflow defined | Fully automated steps specified | Pre-deploy, post-deploy, rollback validation |

---

## Related Documents

- [REQ-MVP-TEMPLATE.md](../REQ-MVP-TEMPLATE.md) - Updated REQ template with Section 9.5
- [REQ_MVP_SCHEMA.yaml](../REQ_MVP_SCHEMA.yaml) - Schema including Section 9.5 validation rules
- [REQ_MVP_VALIDATION_RULES.md](../REQ_MVP_VALIDATION_RULES.md) - Validation rules including Section 9.5 checks
- [README.md](../README.md) - REQ layer documentation and usage guide

---

## Traceability Tags

```markdown
@brd: BRD.01.01.05
@prd: PRD.01.01.03
@ears: EARS.01.01.02
@bdd: BDD.02.01.01
@adr: ADR-02
@sys: SYS.02.09.01
```

---

**Version**: 1.0.0
**Last Updated**: 2026-01-19
**Maintained By**: System Architect, Quality Assurance Team
